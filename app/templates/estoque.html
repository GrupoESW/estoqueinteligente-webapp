{% extends 'base.html' %}

{% block conteudo %} 

<script>
  $(document).ready(function(){
    $("#stock-operation").on('submit', function(event) {
      event.preventDefault(); 
      var ing = $("#product").val();
      var qnt = $("#quantity").val();
      var unid = $("#unid").val();
      var validade = $("#validade").val();

      var operation = $("#operation").val();
    
      // Converte a data para o formato dd/mm/aaaa
      const dateValue = validade; // valor no formato aaaa-mm-dd
      if (dateValue) {
          const [year, month, day] = dateValue.split('-');
          const formattedDate = `${day}/${month}/${year}`;
          validade = formattedDate;
      }

      var url;
      if(operation === 'add') {
        url = 'http://{{ api_url }}/ingredientes/add';
      } else if(operation === 'remove') {
        url = 'http://{{ api_url }}/ingredientes/remove';
      } else {
        alert('Operação desconhecida');
        return;
      }

    var token = localStorage.getItem('jwt'); // Obtenha o token do localStorage

    $.ajax({
        url: url,
        type: 'GET',
        data: {
          nome: ing,
          quantidade: qnt,
          unidade: unid,
          validade: validade
        },
        headers: {
        'Authorization': 'Bearer ' + token, // Adicione o token ao cabeçalho de autorização
    },
        success: function(response) {
          location.href = location.href;
        },
        error: function() {
          alert('Acesso Negado!! ' + url + ' ' + ing + ' ' + qnt)
        }
      });
  });
  });
</script>    

 <div class="panels"> 
    <button class="botoes" id="inserePopupOpen">Editar estoque</button>
  </div>
  <div id="popup" class="popup">
      <div class="popup-content">
          <span id="inserePopupClose" class="close-button">&times;</span>
          <form id="stock-operation">
            <label for="product">Produto:</label><br>
            <input type="text" id="product" name="product" required><br>
            
            <label for="quantity">Quantidade:</label><br>
            <input type="number" id="quantity" name="quantity" min="0" value="0" required><br>
            
            <label for="unid">Unidade:</label><br>
            <input type="text" id="unid" name="unid" value="kg" required><br>

            <label for="validade">Validade:</label><br>
            <input type="date" id="validade" name="validade" value="2024-06-20" required><br>

            <label for="operation">Operação:</label><br>
            <select id="operation" name="operation">
              <option value="add">Adicionar ao estoque</option>
              <option value="remove">Remover do estoque</option>
            </select><br>
            
            <input type="submit" value="Executar">
          </form>
      </div>
  </div>
  {% include "tabela.html" %}
  <script src="{{ url_for('static', filename='popupEstoque.js') }}"></script>
    {% endblock conteudo %}
